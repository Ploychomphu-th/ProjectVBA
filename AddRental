Private Sub UserForm_Initialize()
    ' Load MemberID and BookID into ComboBox
    LoadMembers
    LoadBooks
    ' Set default values
    txtRentalDate.Value = Format(Date, "dd-mm-yyyy")
End Sub

' Load MemberID from Table: MemberList
Private Sub LoadMembers()
    Dim ws As Worksheet
    Dim memberTable As ListObject
    Dim i As Long
    
    ' Clear previous data
    cmbMemberID.Clear
    
    ' Retrieve data from Table: MemberList
    Set ws = ThisWorkbook.Sheets("Members")
    Set memberTable = ws.ListObjects("MemberList")
    
    ' Loop through and add MemberID to ComboBox
    For i = 1 To memberTable.ListRows.Count
        cmbMemberID.AddItem memberTable.ListRows(i).Range.Cells(1, 1).Value ' Add MemberID
    Next i
End Sub

' Load BookID from Table: Book
Private Sub LoadBooks()
    Dim ws As Worksheet
    Dim bookTable As ListObject
    Dim i As Long
    
    ' Clear previous data
    cmbBookID.Clear
    
    ' Retrieve data from Table: Book
    Set ws = ThisWorkbook.Sheets("Stock")
    Set bookTable = ws.ListObjects("Book")
    
    ' Loop through and add BookID to ComboBox
    For i = 1 To bookTable.ListRows.Count
        cmbBookID.AddItem bookTable.ListRows(i).Range.Cells(1, 1).Value ' Add BookID
    Next i
End Sub

' Validate MemberID when selected from ComboBox
Private Sub cmbMemberID_Change()
    Dim ws As Worksheet
    Dim memberTable As ListObject
    Dim i As Long
    Dim found As Boolean
    
    ' Initialize
    found = False
    
    ' Retrieve data from Table: MemberList
    Set ws = ThisWorkbook.Sheets("Members")
    Set memberTable = ws.ListObjects("MemberList")
    
    ' Search for MemberID
    For i = 1 To memberTable.ListRows.Count
        If memberTable.ListRows(i).Range.Cells(1, 1).Value = cmbMemberID.Value Then
            lblMemberStatus.Caption = "Member Found"
            lblMemberStatus.ForeColor = RGB(0, 128, 0) ' Green color
            found = True
            Exit For
        End If
    Next i
    
    ' If not found
    If Not found Then
        lblMemberStatus.Caption = "Member Not Found"
        lblMemberStatus.ForeColor = RGB(255, 0, 0) ' Red color
    End If
End Sub

' Validate BookID and retrieve Title & Rental Price
Private Sub cmbBookID_Change()
    Dim ws As Worksheet
    Dim bookTable As ListObject
    Dim i As Long
    Dim found As Boolean
    
    ' Initialize
    found = False
    
    ' Retrieve data from Table: Book
    Set ws = ThisWorkbook.Sheets("Stock")
    Set bookTable = ws.ListObjects("Book")
    
    ' Search for BookID
    For i = 1 To bookTable.ListRows.Count
        If bookTable.ListRows(i).Range.Cells(1, 1).Value = cmbBookID.Value Then
            txtTitle.Value = bookTable.ListRows(i).Range.Cells(1, 2).Value ' Title
            txtRentalPrice.Value = bookTable.ListRows(i).Range.Cells(1, 6).Value ' Rental Price
            Label9.Caption = "Available Stock: " & bookTable.ListRows(i).Range.Cells(1, 7).Value ' Stock
            found = True
            Exit For
        End If
    Next i
    
    ' If not found
    If Not found Then
        txtTitle.Value = ""
        txtRentalPrice.Value = ""
        Label9.Caption = "Available Stock: 0"
    End If
End Sub


Private Sub txtQuantity_Change()
    ' Validate input data
    If IsNumeric(txtQuantity.Value) And IsNumeric(txtRentalPrice.Value) Then
        txtTotalPrice.Value = CInt(txtQuantity.Value) * CDbl(txtRentalPrice.Value)
    Else
        txtTotalPrice.Value = ""
    End If
End Sub

Private Sub txtRentalDate_Change()
    ' Set DueDate to 7 days after RentalDate
    If IsDate(txtRentalDate.Value) Then
        txtDueDate.Value = DateAdd("d", 7, CDate(txtRentalDate.Value))
    Else
        txtDueDate.Value = ""
    End If
End Sub

Private Sub btnAdd_Click()
    Dim ws As Worksheet
    Dim orderTable As ListObject
    Dim bookTable As ListObject
    Dim newRow As ListRow
    Dim nextNo As Integer
    Dim stockQty As Integer
    Dim i As Long
    
    ' Validate that Member and Book exist
    If lblMemberStatus.Caption = "Member Not Found" Or txtTitle.Value = "" Then
        MsgBox "Invalid Member ID or Book ID!", vbExclamation
        Exit Sub
    End If
    
    ' Set Worksheet and Table
    Set ws = ThisWorkbook.Sheets("Rental")
    Set orderTable = ws.ListObjects("Order")
    
    ' Get Book Stock from Table: Book
    Set ws = ThisWorkbook.Sheets("Stock") ' Sheet where Book Table is stored
    Set bookTable = ws.ListObjects("Book")
    
    stockQty = 0 ' Default value

    ' Search for BookID in Book Table
    For i = 1 To bookTable.ListRows.Count
        If bookTable.ListRows(i).Range.Cells(1, 1).Value = cmbBookID.Value Then
            stockQty = bookTable.ListRows(i).Range.Cells(1, 7).Value ' Column 7 = Stock Quantity
            Exit For
        End If
    Next i

    ' Validate Quantity
    If CInt(txtQuantity.Value) > stockQty Then
        MsgBox "This item is Out of Stock! Cannot Add.", vbCritical, "Stock Error"
        Exit Sub
    End If

    ' Get the next #No value
    If orderTable.ListRows.Count = 0 Then
        nextNo = 1
    Else
        nextNo = Application.WorksheetFunction.Max(orderTable.ListColumns(1).DataBodyRange) + 1
    End If
    
    ' Add a new row to Table: Order
    Set newRow = orderTable.ListRows.Add
    With newRow.Range
        .Cells(1, 1).Value = nextNo ' #No
        .Cells(1, 2).Value = cmbMemberID.Value
        .Cells(1, 3).Value = cmbBookID.Value
        .Cells(1, 4).Value = txtTitle.Value
        .Cells(1, 5).Value = txtRentalDate.Value
        .Cells(1, 6).Value = txtDueDate.Value
        .Cells(1, 7).Value = txtRentalPrice.Value
        .Cells(1, 8).Value = txtQuantity.Value
        .Cells(1, 9).Value = txtTotalPrice.Value
    End With
    
    MsgBox "Rental added successfully!", vbInformation

    ' Clear values after adding data
    cmbBookID.Value = ""
    txtTitle.Value = ""
    txtRentalPrice.Value = ""
    txtQuantity.Value = ""
    txtRentalDate.Value = Format(Date, "dd-mm-yyyy")
    
    txtTotalPrice.Value = ""

End Sub



Private Sub btnCancel_Click()
    ' Clear all values and close the form
    cmbMemberID.Value = ""
    cmbBookID.Value = ""
    txtTitle.Value = ""
    txtRentalPrice.Value = ""
    txtQuantity.Value = ""
    txtRentalDate.Value = Format(Date, "dd-mm-yyyy")
    
    txtTotalPrice.Value = ""
    Me.Hide
End Sub



